<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÎèÑÏÑú Ï∂îÏ≤ú AI</title>
    <style>
      :root {
        --bg-color: #141414;
        --text-white: #e5e5e5;
        --netflix-red: #E50914;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-white);
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        overflow-x: hidden;
      }

      /* Main Container */
      main {
        padding: 80px 0 50px 0;
      }

      .container {
        max-width: 100%;
        padding: 0;
      }

      /* Header */
      .header-section {
        text-align: center;
        padding: 40px 4% 60px 4%;
      }

      .header-section h1 {
        font-size: 3vw;
        font-weight: bold;
        margin-bottom: 20px;
        color: var(--text-white);
      }

      .header-section p {
        font-size: 1.2vw;
        color: #b3b3b3;
      }

      /* Slider Container */
      .slider-container {
        position: relative;
        display: flex;
        align-items: center;
        margin-bottom: 40px;
      }

      .slider-track {
        display: flex;
        gap: 10px;
        overflow-x: auto;
        scroll-behavior: smooth;
        padding: 20px 4%;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */
      }

      /* Scrollbar hiding */
      .slider-track::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
      }

      /* Card */
      .card {
        position: relative;
        width: 250px;
        height: 350px;
        border-radius: 4px;
        transition: transform 0.3s ease, z-index 0.3s ease;
        cursor: pointer;
        background-color: #333;
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        will-change: transform;
        backface-visibility: hidden;
        transform-origin: center;
        -webkit-font-smoothing: antialiased;
      }

      .card img {
        width: 100%;
        height: 300px;
        min-height: 300px;
        max-height: 300px;
        object-fit: contain;
        object-position: center;
        border-radius: 4px 4px 0 0;
        display: block;
        background-color: #444;
      }

      .card-img-placeholder {
        width: 100%;
        height: 300px;
        min-height: 300px;
        max-height: 300px;
        background-color: #444;
        border-radius: 4px 4px 0 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 80px;
        color: #888;
      }

      .card-body {
        padding: 15px;
        background-color: #333;
        border-radius: 0 0 4px 4px;
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 50px;
        max-height: 50px;
        overflow: hidden;
        backface-visibility: hidden;
        transform: translateZ(0);
      }

      .card-title {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 5px;
        color: var(--text-white);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .card-category {
        font-size: 12px;
        color: #b3b3b3;
        margin-bottom: 5px;
      }

      .card-rating {
        font-size: 11px;
        color: #ffa500;
        margin: 0;
      }

      /* Card Selection State */
      .card.selected {
        border: 3px solid var(--netflix-red);
        box-shadow: 0 0 15px rgba(229, 9, 20, 0.6);
      }

      .card.selected::before {
        content: '‚úì';
        position: absolute;
        top: 10px;
        right: 10px;
        width: 30px;
        height: 30px;
        background-color: var(--netflix-red);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        font-weight: bold;
        z-index: 101;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
      }

      /* Hidden checkbox for form submission */
      .card-checkbox {
        display: none;
      }

      /* Hover Effect: Scale up */
      .card:hover {
        transform: scale(1.15);
        z-index: 100;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
      }

      .card.selected:hover {
        box-shadow: 0 0 25px rgba(229, 9, 20, 0.8);
      }

      /* Navigation Buttons */
      .handle {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 4%;
        min-width: 50px;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: 2rem;
        font-weight: bold;
        z-index: 200;
        cursor: pointer;
        border: none;
        opacity: 0;
        transition: opacity 0.3s, background 0.3s, transform 0.3s;
        pointer-events: auto;
      }

      .slider-container:hover .handle {
        opacity: 1;
      }

      .handle:hover {
        background: rgba(0, 0, 0, 0.8);
        transform: scale(1.1);
      }

      .handle.left {
        left: 0;
        border-top-right-radius: 4px;
        border-bottom-right-radius: 4px;
      }

      .handle.right {
        right: 0;
        border-top-left-radius: 4px;
        border-bottom-left-radius: 4px;
      }

      /* Submit Button */
      .submit-section {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.7) 50%, transparent 100%);
        padding: 30px 4%;
        text-align: center;
        z-index: 1000;
      }

      .submit-btn {
        background-color: var(--netflix-red);
        color: white;
        border: none;
        padding: 15px 50px;
        font-size: 18px;
        font-weight: bold;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
      }

      .submit-btn:hover {
        background-color: #f40612;
        transform: scale(1.05);
      }

      .submit-btn:active {
        transform: scale(0.98);
      }

      @media (max-width: 768px) {
        .header-section h1 {
          font-size: 6vw;
        }

        .header-section p {
          font-size: 3vw;
        }

        .card {
          width: 180px;
          height: 300px;
        }

        .card img {
          height: 250px;
          min-height: 250px;
          max-height: 250px;
          object-fit: contain;
        }

        .card-img-placeholder {
          height: 250px;
          min-height: 250px;
          max-height: 250px;
          font-size: 60px;
        }

        .card-body {
          min-height: 50px;
          max-height: 50px;
        }

        .handle {
          width: 8%;
          min-width: 40px;
          font-size: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <div class="container">
        <div class="header-section">
          <h1>üìö AI ÎèÑÏÑú Ï∂îÏ≤ú ÏãúÏä§ÌÖú</h1>
          <p>Í¥ÄÏã¨ ÏûàÎäî Ï±ÖÏùÑ <b>3Í∂å Ïù¥ÏÉÅ</b> ÏÑ†ÌÉùÌïòÎ©¥, AIÍ∞Ä Î∂ÑÏÑùÌïòÏó¨ Ï∂îÏ≤úÌï¥ ÎìúÎ¶ΩÎãàÎã§.</p>
        </div>

        <form action="/recommend-view" method="post" id="book-form">
          <div th:each="bookRow, rowStat : ${bookRows}" class="slider-container">
            <button type="button" class="handle left" th:onclick="'scrollLeft_' + ${rowStat.index} + '()'">&#8249;</button>
            <div class="slider-track" th:id="'slider-track-' + ${rowStat.index}">
              <div class="card" th:each="book : ${bookRow}" 
                   th:data-isbn="${book.isbn}">
                <input type="checkbox" 
                       class="card-checkbox" 
                       name="isbns" 
                       th:value="${book.isbn}"
                       th:id="${'check-' + book.isbn}" />
                <img th:if="${book.imageUrl != null && !book.imageUrl.isEmpty()}" 
                th:src="${book.imageUrl}"
                     th:alt="${book.title}"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                <div class="card-img-placeholder" th:if="${book.imageUrl == null || book.imageUrl.isEmpty()}">
                  <span>üìö</span>
                </div>
                <div class="card-img-placeholder" style="display: none;" th:if="${book.imageUrl != null && !book.imageUrl.isEmpty()}">
                  <span>üìö</span>
                </div>
              <div class="card-body">
                <h6 class="card-title" th:text="${book.title}">Ï±Ö Ï†úÎ™©</h6>
                  <p class="card-category" th:text="${book.category}">Ïπ¥ÌÖåÍ≥†Î¶¨</p>
                  <p class="card-rating" th:if="${book.rating > 0}">
                    <span th:text="${#numbers.formatDecimal(book.rating, 1, 1)}">ÌèâÏ†ê</span> ‚≠ê
                  </p>
                </div>
              </div>
            </div>
            <button type="button" class="handle right" th:onclick="'scrollRight_' + ${rowStat.index} + '()'">&#8250;</button>
        </div>

          <div class="submit-section">
            <button type="submit" class="submit-btn">üöÄ AI Ï∂îÏ≤ú Î∞õÍ∏∞</button>
        </div>
      </form>
    </div>
    </main>

    <script>
      // Book selection toggle function
      function toggleBookSelection(isbn) {
        const card = document.querySelector('.card[data-isbn="' + isbn + '"]');
        const checkbox = document.getElementById('check-' + isbn);
        
        if (!card || !checkbox) return;
        
        // Toggle checkbox state
        checkbox.checked = !checkbox.checked;
        
        // Toggle selected class
        if (checkbox.checked) {
          card.classList.add('selected');
        } else {
          card.classList.remove('selected');
        }
      }
      
      document.addEventListener('DOMContentLoaded', function() {
        // Ïπ¥Îìú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
        const cards = document.querySelectorAll('.card');
        cards.forEach(function(card) {
          card.addEventListener('click', function() {
            const isbn = card.getAttribute('data-isbn');
            toggleBookSelection(isbn);
          });
        });
        
        // Î™®Îì† slider-track ÏöîÏÜå Ï∞æÍ∏∞
        const sliderTracks = document.querySelectorAll('.slider-track');
        
        sliderTracks.forEach(function(sliderTrack, index) {
          // Smooth scroll behavior
          sliderTrack.style.scrollBehavior = 'smooth';
          
          const container = sliderTrack.closest('.slider-container');
          const leftBtn = container.querySelector('.handle.left');
          const rightBtn = container.querySelector('.handle.right');
          
          // Global functions for each row
          window['scrollLeft_' + index] = function() {
            sliderTrack.scrollLeft -= window.innerWidth * 0.8;
          };
          
          window['scrollRight_' + index] = function() {
            sliderTrack.scrollLeft += window.innerWidth * 0.8;
          };
          
          // Show/hide navigation buttons based on scroll position
          function updateButtonVisibility() {
            const isAtStart = sliderTrack.scrollLeft <= 10;
            const isAtEnd = sliderTrack.scrollLeft >= sliderTrack.scrollWidth - sliderTrack.clientWidth - 10;
            
            if (leftBtn) leftBtn.style.opacity = isAtStart ? '0' : '1';
            if (rightBtn) rightBtn.style.opacity = isAtEnd ? '0' : '1';
          }
          
          sliderTrack.addEventListener('scroll', updateButtonVisibility);
          updateButtonVisibility();
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
          sliderTracks.forEach(function(sliderTrack) {
            const container = sliderTrack.closest('.slider-container');
            const leftBtn = container.querySelector('.handle.left');
            const rightBtn = container.querySelector('.handle.right');
            
            const isAtStart = sliderTrack.scrollLeft <= 10;
            const isAtEnd = sliderTrack.scrollLeft >= sliderTrack.scrollWidth - sliderTrack.clientWidth - 10;
            
            if (leftBtn) leftBtn.style.opacity = isAtStart ? '0' : '1';
            if (rightBtn) rightBtn.style.opacity = isAtEnd ? '0' : '1';
          });
        });
      });
    </script>
  </body>
</html>
