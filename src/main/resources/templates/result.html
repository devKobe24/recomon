<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>추천 결과</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <h1 class="text-center mb-5">✨ AI가 발견한 당신의 취향</h1>

      <!-- 에러 메시지 표시 -->
      <div th:if="${errorMessage != null}" class="alert alert-warning text-center" role="alert">
        <strong>⚠️ 알림</strong>
        <p th:text="${errorMessage}"></p>
      </div>

      <!-- 추천 결과가 없을 때 안내 메시지 -->
      <div th:if="${recommendations == null || recommendations.isEmpty()}" class="text-center py-5">
        <h3 class="text-muted mb-3">추천 도서를 찾을 수 없습니다</h3>
        <p class="text-muted">다른 도서를 선택해보시거나 잠시 후 다시 시도해주세요.</p>
        <a href="/books" class="btn btn-primary mt-3">다시 선택하기</a>
      </div>

      <!-- 추천 결과 표시 -->
      <div th:if="${recommendations != null && !recommendations.isEmpty()}" class="row row-cols-1 row-cols-md-5 g-4">
        <div class="col" th:each="book : ${recommendations}">
          <div class="card h-100 border-0 shadow">
            <span
              class="position-absolute top-0 start-0 translate-middle badge rounded-pill bg-danger"
              style="margin-left: 20px; margin-top: 10px"
            >
              추천
            </span>

            <div class="card-img-container" style="height: 300px; background-color: #e9ecef; position: relative; overflow: hidden;">
              <!-- 이미지가 있는 경우 -->
              <img th:if="${book.imageUrl != null && !book.imageUrl.isEmpty()}" 
                   th:src="${book.imageUrl}" 
                   th:alt="${book.title}"
                   class="book-cover-image"
                   style="width: 100%; height: 100%; object-fit: contain; object-position: center; display: block;"
                   onerror="var container = this.parentElement; this.style.display='none'; var fallback = container.querySelector('.card-img-placeholder-fallback'); if(fallback) fallback.style.display='flex';" />
              <!-- 이미지 로드 실패 시 표시될 placeholder (이미지가 있는 경우에만 생성) -->
              <div th:if="${book.imageUrl != null && !book.imageUrl.isEmpty()}"
                   class="card-img-placeholder-fallback" 
                   style="display: none; height: 100%; width: 100%; position: absolute; top: 0; left: 0; align-items: center; justify-content: center; font-size: 60px; background-color: #e9ecef;">
                <span>📚</span>
              </div>
              <!-- 이미지가 없는 경우 -->
              <div class="card-img-placeholder" 
                   th:if="${book.imageUrl == null || book.imageUrl.isEmpty()}"
                   style="height: 100%; width: 100%; display: flex; align-items: center; justify-content: center; font-size: 60px;">
              <span>📚</span>
              </div>
            </div>
            <div class="card-body">
              <h6 class="card-title fw-bold" th:text="${book.title}">제목</h6>
              <p
                class="card-text small text-secondary"
                th:text="${book.author}"
              >
                저자
              </p>
              <p class="badge bg-secondary" th:text="${book.category}">
                카테고리
              </p>
              <p class="card-text small text-muted" th:if="${book.rating > 0}">
                평점: <span th:text="${#numbers.formatDecimal(book.rating, 1, 1)}">0.0</span> ⭐ | 
                리뷰: <span th:text="${book.reviewCount}">0</span>개
              </p>
            </div>
          </div>
        </div>
      </div>

      <div th:if="${recommendations != null && !recommendations.isEmpty()}" class="text-center mt-5">
        <a href="/books" class="btn btn-outline-dark">다시 선택하기</a>
      </div>
    </div>
  </body>
</html>
